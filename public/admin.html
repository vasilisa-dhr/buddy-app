<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin ‚Äî Secret Buddy</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <main class="container">
    <h1>üéÑ –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å üéÅ</h1>
    <div class="actions">
      <a class="btn" href="/admin/export.csv">–°–∫–∞—á–∞—Ç—å CSV</a>
      <a class="btn" href="/admin/links.csv">–°—Å—ã–ª–∫–∏</a>
      <button class="btn btn-danger" onclick="resetAssignments()">–°–±—Ä–æ—Å–∏—Ç—å –∂–µ—Ä–µ–±—å–µ–≤–∫—É</button>
    </div>
    <table class="table" id="table">
      <thead>
        <tr>
          <th>–î–∞—Ä–∏—Ç–µ–ª—å</th>
          <th>–ü–æ–¥–æ–ø–µ—á–Ω—ã–π</th>
          <th>–î–† –ø–æ–¥–æ–ø–µ—á–Ω–æ–≥–æ</th>
          <th>–ì–æ–¥–æ–≤—â–∏–Ω–∞ –ø–æ–¥–æ–ø–µ—á–Ω–æ–≥–æ</th>
          <th>–°—Å—ã–ª–∫–∞</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>
  <script>
    async function load() {
      const res = await fetch('/admin/export.csv');
      if (!res.ok) return;
      const text = await res.text();
      const rows = text.trim().split('\n').slice(1).map(r => r.split(','));
      const tbody = document.querySelector('#table tbody');
      tbody.innerHTML = '';
      for (const r of rows) {
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${r[0]}</td><td>${r[3]}</td><td>${r[4]}</td><td>${r[5]}</td><td><code>${r[6]}</code></td>`;
        tbody.appendChild(tr);
      }
    }

    async function resetAssignments() {
      if (!confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –∂–µ—Ä–µ–±—å–µ–≤–∫—É? –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ —Ç–µ–∫—É—â–∏–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –∏ –ø–æ–∑–≤–æ–ª–∏—Ç –ø—Ä–æ–≤–µ—Å—Ç–∏ –Ω–æ–≤—É—é –∂–µ—Ä–µ–±—å–µ–≤–∫—É.')) {
        return;
      }
      
      try {
        const res = await fetch('/admin/reset', { method: 'POST' });
        if (res.ok) {
          alert('–ñ–µ—Ä–µ–±—å–µ–≤–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –Ω–æ–≤—É—é –∂–µ—Ä–µ–±—å–µ–≤–∫—É.');
          load(); // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
        } else {
          alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –∂–µ—Ä–µ–±—å–µ–≤–∫–∏');
        }
      } catch (error) {
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –∂–µ—Ä–µ–±—å–µ–≤–∫–∏: ' + error.message);
      }
    }

    load();
  </script>
</body>
</html>



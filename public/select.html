<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Secret Buddy ‚Äî –í—ã–±–µ—Ä–∏ —Å–µ–±—è</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <main class="container">
    <h1>üéÑ Secret Buddy üéÅ</h1>
    <div class="welcome-text">
      –ü—Ä–∏–≤–µ—Ç! üëã<br>
      –í—ã–±–µ—Ä–∏ —Å–≤–æ–µ –∏–º—è –∏–∑ —Å–ø–∏—Å–∫–∞, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, –∫–æ–º—É —Ç—ã –±—É–¥–µ—à—å –¥–∞—Ä–∏—Ç—å –ø–æ–¥–∞—Ä–æ–∫:
    </div>
    <div id="participants-list"></div>
    <div id="result"></div>
  </main>
  <script>
    async function loadParticipants() {
      try {
        const res = await fetch('/api/participants');
        if (!res.ok) throw new Error('Failed to load participants');
        const participants = await res.json();
        
        const list = document.getElementById('participants-list');
        list.className = 'participants-list';
        list.innerHTML = '';
        
        participants.forEach(participant => {
          const button = document.createElement('button');
          button.className = 'btn btn-primary participant-btn';
          button.textContent = `${participant.name}`;
          button.onclick = () => selectParticipant(participant.token);
          list.appendChild(button);
        });
      } catch (error) {
        document.getElementById('participants-list').innerHTML = 
          '<p style="color: #dc3545;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</p>';
      }
    }

    async function selectParticipant(token) {
      const result = document.getElementById('result');
      result.innerHTML = '<div class="welcome-text">–ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–≤–æ–µ–≥–æ –ø–æ–¥–æ–ø–µ—á–Ω–æ–≥–æ... ‚è≥</div>';
      
      try {
        const res = await fetch('/api/assign', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ token })
        });
        
        const data = await res.json();
        
        if (data.assignee) {
          result.innerHTML = `
            <div class="card">
              <h2 style="color: #E32213; margin-bottom: 16px;">üéâ –¢–≤–æ–π –ø–æ–¥–æ–ø–µ—á–Ω—ã–π:</h2>
              <p class="name">${data.assignee.name}</p>
              <ul class="dates">
                <li>üéÇ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è: <strong>${data.assignee.birthday}</strong></li>
                <li>üíç –ì–æ–¥–æ–≤—â–∏–Ω–∞: <strong>${data.assignee.anniversary}</strong></li>
              </ul>
            </div>
          `;
        } else {
          result.innerHTML = `<div class="welcome-text" style="color: #dc3545;">–û—à–∏–±–∫–∞: ${data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞'}</div>`;
        }
      } catch (error) {
        result.innerHTML = `<div class="welcome-text" style="color: #dc3545;">–û—à–∏–±–∫–∞: ${error.message}</div>`;
      }
    }

    loadParticipants();
  </script>
</body>
</html>

<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Secret Buddy</title>
  <link rel="stylesheet" href="/style.css" />
</head>
<body>
  <main class="container">
    <h1>ğŸ„ Secret Buddy ğŸ</h1>
    <div id="content"></div>
    <script>
      async function load() {
        const token = location.pathname.split('/').pop();
        const who = await fetch(`/api/whoami/${token}`).then(r => r.json());
        const me = who.me;
        const content = document.getElementById('content');
        if (!me) { content.textContent = 'ĞĞµĞ²ĞµÑ€Ğ½Ğ°Ñ ÑÑÑ‹Ğ»ĞºĞ°'; return; }
        const btn = document.createElement('button');
        btn.textContent = 'ğŸ ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¾Ğ¿ĞµÑ‡Ğ½Ğ¾Ğ³Ğ¾ ğŸ„';
        btn.className = 'btn btn-primary';
        const card = (p) => `
          <div class="card">
            <h2 style="color: #E32213; margin-bottom: 16px;">ğŸ‰ Ğ¢Ğ²Ğ¾Ğ¹ Ğ¿Ğ¾Ğ´Ğ¾Ğ¿ĞµÑ‡Ğ½Ñ‹Ğ¹:</h2>
            <p class="name">${p.name}</p>
            <ul class="dates">
              <li>ğŸ‚ Ğ”ĞµĞ½ÑŒ Ñ€Ğ¾Ğ¶Ğ´ĞµĞ½Ğ¸Ñ: <strong>${p.birthday}</strong></li>
              <li>ğŸ’ Ğ“Ğ¾Ğ´Ğ¾Ğ²Ñ‰Ğ¸Ğ½Ğ°: <strong>${p.anniversary}</strong></li>
            </ul>
          </div>`;
        const result = document.createElement('div');
        content.innerHTML = `<div class="welcome-text">ĞŸÑ€Ğ¸Ğ²ĞµÑ‚, <strong>${me.name}</strong>! ğŸ‘‹<br>Ğ“Ğ¾Ñ‚Ğ¾Ğ² ÑƒĞ·Ğ½Ğ°Ñ‚ÑŒ, ĞºĞ¾Ğ¼Ñƒ Ñ‚Ñ‹ Ğ±ÑƒĞ´ĞµÑˆÑŒ Ğ´Ğ°Ñ€Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ°Ñ€Ğ¾Ğº?</div>`;
        content.appendChild(btn);
        content.appendChild(result);
        btn.addEventListener('click', async () => {
          btn.disabled = true;
          const res = await fetch('/api/assign', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ token })
          }).then(r => r.json());
          if (res.assignee) {
            result.innerHTML = card(res.assignee);
          } else {
            result.textContent = res.error || 'ĞÑˆĞ¸Ğ±ĞºĞ°';
          }
        });
      }
      load();
    </script>
  </main>
</body>
</html>


